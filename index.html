<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Up To Drive</title>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- import the webpage's stylesheet -->
        <!-- <link rel="stylesheet" href="/style.css" /> -->
        <link rel="stylesheet" href="/style/output.css" />

        <!-- import the webpage's javascript file -->
        <!-- <script src="/js/share.js" defer></script> -->
        <script src="/js/common.js" defer></script>
        <link rel="manifest" href="/manifest.json" />
        <meta name="theme-color" content="#ff0000" />
    </head>
    <body class="bg-slate-100 h-svh flex flex-col items-center p-5">
        <div
            class="rounded-md shadow bg-white min-w-[400px] max-w-2xl p-5 flex flex-col gap-10"
        >
            <div class="flex gap-2 items-center justify-center">
                <img
                    src="/images/icons/icon-512x512.svg"
                    width="60px"
                    height="60px"
                    alt="Up To Drive"
                />
                <h1 class="text-3xl font-bold">Up To Drive</h1>
            </div>
            <p class="text-xl text-slate-600">
                Just a humble app to make evidence upload easier. ðŸ™ƒ
            </p>
            <div>
                <label for="file-input" class="sr-only">Choose file</label>
                <input
                    type="file"
                    name="file-input"
                    id="fileInput"
                    class="block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"
                />
            </div>

            <div>
                <button
                    id="btnSend"
                    class="bg-blue-500 rounded py-2 px-5 text-white font-bold disabled:bg-slate-400"
                    type="submit"
                >
                    Send to Drive
                </button>
            </div>
        </div>
        <script async>
            document.addEventListener("DOMContentLoaded", () => {
                const fileInput = document.querySelector("#fileInput");
                const btnSend = document.querySelector("#btnSend");
                const toaster = document.querySelector("#toaster");

                btnSend.addEventListener("click", async () => {
                    console.log("FILE", fileInput.files[0]);

                    if (fileInput.files.length > 0) {
                        btnSend.disabled = true;
                        btnSend.innerText = "Uploading...";
                    }

                    const formData = new FormData();
                    formData.append("file", fileInput.files[0]);
                    formData.append("customName", "custon-name-alan");
                    formData.append("folder", window.parentFolder);

                    const options = {
                        method: "POST",
                        body: formData,
                    };

                    fetch(window.apiUrl + "/upload", options)
                        .then((response) => response.json())
                        .then((response) => {
                            console.log(response);
                            showToaster();
                            btnSend.disabled = false;
                            btnSend.innerText = "Send To Drive";
                        })
                        .catch((error) => {
                            showToaster("fail");
                        });
                });

                const toasterClasses = {
                    base: "  ",
                    success: " border-green-400 bg-green-50 ",
                    fail: " border-red-400 bg-red-50 ",
                };

                function showToaster(status) {
                    toaster.style.bottom = "20vh";
                    if (status == "fail") {
                        toaster.style.border = "1px solid red";
                        toaster.style.background = "#ff777711";
                        toaster.innerHTML = `<span>ðŸ‘Ž</span> Error on sending file.`;
                    } else {
                        toaster.style.border = "1px solid green";
                        toaster.style.background = "#77ff7744";
                        toaster.innerHTML = `<span>ðŸ™Œ</span> File has been sent successfuly!`;
                    }

                    setTimeout(() => {
                        hideToaster();
                    }, 5000);
                }

                function hideToaster() {
                    toaster.style.bottom = "-20vh";
                }

                // btnSend.addEventListener("click", async () => {
                //     const file = fileInput.files[0];
                //     const fileReader = new FileReader();
                //     fileReader.onload = function (e) {
                //         const blob = dataURLtoBlob(fileReader.result);
                //         console.log("FILEEEE", blob);
                //     };

                //     return;
                //     // Converte a data URL para um blob
                //     const blob = await fileInput.files[0].blob();

                //     const formData = new FormData();
                //     formData.append("image", blob, "image.png");

                //     // Envia o arquivo para o backend (Node.js)
                //     fetch("http://localhost:4000/uploads", {
                //         method: "POST",
                //         body: formData,
                //     })
                //         .then((response) => response.text())
                //         .then((result) => {
                //             alert(result);
                //         })
                //         .catch((error) => {
                //             console.error("Erro ao fazer upload:", error);
                //             alert("Erro ao enviar o arquivo.");
                //         });

                //     // fetch("http://localhost:4000/uploads", { method: "POST" });
                // });
            });
        </script>
        <div
            id="toaster"
            class="bottom-[-60px] border h-12 px-5 text-md font-bold flex gap-5 items-center min-w-[360] fixed transition-all"
        >
            <span>ðŸ™Œ</span> Arquivo enviado com sucesso!
        </div>
    </body>
</html>
